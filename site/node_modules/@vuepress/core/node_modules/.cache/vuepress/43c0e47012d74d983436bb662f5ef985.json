{"remainingRequest":"/home/geof/projects/refonte-schema/schema.data.gouv.fr/site/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/geof/projects/refonte-schema/schema.data.gouv.fr/site/site/.vuepress/theme/global-components/InventoryBase.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/home/geof/projects/refonte-schema/schema.data.gouv.fr/site/site/.vuepress/theme/global-components/InventoryBase.vue","mtime":1628086293276},{"path":"/home/geof/projects/refonte-schema/schema.data.gouv.fr/site/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/geof/projects/refonte-schema/schema.data.gouv.fr/site/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/geof/projects/refonte-schema/schema.data.gouv.fr/site/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/geof/projects/refonte-schema/schema.data.gouv.fr/site/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/geof/projects/refonte-schema/schema.data.gouv.fr/site/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZnItdGFnLmdyZWVuIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDBhYzhjOwogIGNvbG9yOiB3aGl0ZTsKfQouZnItdGFnLnllbGxvdyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZkY2Y0MTsKfQouZnItdGFnLnJlZCB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmNmY0YzsKfQo="},{"version":3,"sources":["InventoryBase.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"InventoryBase.vue","sourceRoot":"site/.vuepress/theme/global-components","sourcesContent":["<template>\n  <div>\n    <InventoryDataProxy\n      :mapping=\"mapping\"\n      :statuses=\"statuses\"\n      @input=\"\n        datasets = $event.datasets;\n        lastModified = $event.lastModified;\n      \"\n    />\n\n    <div v-if=\"datasets.length > 0\">\n      <InventoryFilter\n        v-model=\"filters\"\n        :types=\"types\"\n        :statuses=\"statuses\"\n        :trimesters=\"trimesters\"\n        :organizations=\"organizations\"\n      />\n\n      <InventoryTable :datasets=\"filteredSortedDatasets\" :columns=\"columns\" />\n\n      <p>Dernière modification : {{ formatDate(lastModified) }}</p>\n    </div>\n    <div v-else>\n      <em>Données en cours de chargement...</em>\n    </div>\n  </div>\n</template>\n\n<script>\nimport moment from \"moment\";\n\nconst mapping = {\n  type: {\n    label: \"Type\",\n    source: \"Données, API ou code source\",\n  },\n  title: {\n    label: \"Titre\",\n    source: \"Données, API, Codes sources concernés\",\n    format: (cell, row) =>\n      row.raw.URL ? `<a href=\"${row.raw.URL}\">${cell}</a>` : cell,\n  },\n  organization: {\n    label: \"Ministère\",\n    source: \"Ministère\",\n  },\n  status: {\n    label: \"Statut d’ouverture\",\n    source: \"État d'avancement\",\n    format: (cell, row) =>\n      `<span class=\"fr-tag ${row.status._class}\">${cell.label}</a>`,\n    width: \"12em\",\n  },\n  date: {\n    label: \"Date estimée de publication\",\n    source: \"Échéance annoncée par les ministères\",\n    format: (cell, row) => {\n      const date = row.date;\n      const [trimester, year] = date.split(\" \");\n\n      if (\n        row.status.key != \"open\" &&\n        moment().year() >= parseInt(year) &&\n        moment().quarter() > parseInt(trimester[1])\n      ) {\n        return `T${moment().quarter()} ${moment().year()}`;\n      } else {\n        return `${trimester} ${year}`;\n      }\n    },\n  },\n};\n\nconst statuses = [\n  {\n    label: \"Disponible\",\n    key: \"open\",\n    visible: true,\n    _class: \"green\",\n    labelExtended: \"disponbiles\",\n  },\n  {\n    label: \"Planifié\",\n    key: \"opening\",\n    visible: true,\n    _class: \"yellow\",\n    labelExtended: \"planifiés\",\n  },\n  {\n    label: \"Non disponible\",\n    key: \"notopen\",\n    visible: true,\n    _class: \"red\",\n    labelExtended: \"non disponibles\",\n  },\n];\n\nexport default {\n  name: \"InventoryBase\",\n  data() {\n    return {\n      statuses,\n      loading: true,\n      query: \"\",\n      datasets: [],\n      lastModified: null,\n      mapping,\n      columns: Object.values(\n        Object.entries(mapping).map((r) => ({ key: r[0], ...r[1] }))\n      ),\n      filters: {},\n    };\n  },\n  computed: {\n    filteredDatasets() {\n      let datasets = this.datasets.slice();\n\n      datasets = datasets\n        .filter((d) => d.status.visible == true)\n        .filter((d) => !this.filters.type || d.type == this.filters.type)\n        .filter(\n          (d) => !this.filters.status || d.status.label == this.filters.status\n        )\n        .filter((d) => !this.filters.org || d.organization == this.filters.org)\n        .filter(\n          (d) => !this.filters.trimester || d.date == this.filters.trimester\n        );\n\n      if (this.query.length < 3) return datasets;\n\n      datasets = datasets.filter((dataset) => {\n        return Object.keys(mapping).some((field) => {\n          if (!dataset[field] || !dataset[field].toLowerCase) return false;\n\n          return dataset[field]\n            .toLowerCase()\n            .includes(this.query.toLowerCase());\n        });\n      });\n\n      return datasets;\n    },\n    filteredSortedDatasets() {\n      return this.filteredDatasets.slice().sort(this.compareTrimesters);\n    },\n    counters() {\n      const count = {\n        closed: 0,\n        opening: 0,\n        preview: 0,\n        open: 0,\n        notopen: 0,\n      };\n      this.filteredDatasets.forEach((dataset) => {\n        const value = dataset.status;\n        const status = this.statuses.find((s) => s.label == value);\n        if (status) {\n          count[status.key] += 1;\n        }\n      });\n      return count;\n    },\n    organizations() {\n      let orgs = this.datasets.map((dataset) => dataset.organization);\n      orgs = [...new Set(orgs)];\n      orgs = orgs.map((o) => ({\n        label: o,\n        key: o,\n        count: this.filteredDatasets.filter((d) => d.organization == o).length,\n      }));\n      orgs.sort((a, b) => b.count - a.count);\n      return orgs;\n    },\n    trimesters() {\n      const trimesters = [\n        ...new Set(\n          this.datasets\n            .sort(this.compareTrimesters)\n            .map((dataset) => dataset.date)\n        ),\n      ];\n      return trimesters.map((t) => ({ label: t, key: t }));\n    },\n    types() {\n      const types = [...new Set(this.datasets.map((dataset) => dataset.type))];\n      return types.map((t) => ({ label: t, key: t }));\n    },\n  },\n  mounted() {},\n  methods: {\n    compareTrimesters(a, b) {\n      const ta = a.date.split(\" \")[1] + a.date.split(\" \")[0];\n      const tb = b.date.split(\" \")[1] + b.date.split(\" \")[0];\n      return ta.localeCompare(tb);\n    },\n    toggle(badge) {\n      const status = this.statuses.find((s) => s.key == badge);\n      status.visible = !status.visible;\n    },\n    formatDate(str) {\n      return moment(str).format(\"DD/MM/YYYY\");\n    },\n  },\n};\n</script>\n\n<style>\n.fr-tag.green {\n  background-color: #00ac8c;\n  color: white;\n}\n.fr-tag.yellow {\n  background-color: #fdcf41;\n}\n.fr-tag.red {\n  background-color: #ff6f4c;\n}\n</style>\n"]}]}